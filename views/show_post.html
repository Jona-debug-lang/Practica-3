<!-- Inicio del documento HTML -->
<!doctype html>

<html dir="ltr">

<head>
        <!-- Configuración meta obligatoria -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
        <link integrity="sha384-nU14brUcp6StFntEOOEBvcJm4huWjB0OcIeQ3fltAfSmuZFrkAif0T+UtNGlKKQv" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="/css_detalle.css">
        <link type="text/css" rel="stylesheet" href="/pag_prin.css">

        <script src="app.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>   
    </head>
    
    <!-- Título de la página -->
    <title>Galeria de arte | Página detalle</title>

  <body>

        <!-- Sección de la imagen superior de la página -->
        <div class="row">
            <!-- Imagen principal de la página -->
            <img src="{{post.image}}" class = "img_prin" >
        </div>

        <!-- Botones de editar y eliminar al inicio de la página -->
        <div class="container text-center">
            <br>
            <div class="row md-12 d-flex">
                <div class="input-group">
                    <a class="input-group-text botona rounded" type="button" data-bs-toggle="modal" data-bs-target="#editarModal">Editar</a>
                    &nbsp;&nbsp;
                    <a class="input-group-text botona rounded" type="button" href="/post/{{post.id}}/delete" >Eliminar</a>
                </div>
            </div>

            <form id="editarModalForm" action="/post/{{post.id}}/edit/edits" method="post">
                <div class="modal fade custom-modal" id="editarModal">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="row">
                                <div class="col">
                                    <!-- Imagen de fondo -->
                                    <br><img src="/Img_principal/logo.jpg" class="fondomodal">
                                </div>
                            </div>

                            <!-- Espacio reservado para el mensaje de validación -->
                            <div class="row">
                                <div class="col-md-12">
                                    <br>
                                    <div id="mensajeValidacion" style="background-color: #f44336; color: white; padding: 10px; margin-bottom: 10px; visibility: hidden;">
                                        <!-- Agrega más texto o contenido aquí según tus necesidades -->
                                    </div>
                                </div>
                            </div>
    
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="subtitlestn">Nombre de la corriente.</p>
                                </div>
                
                                <!--Era-->
                                <div class="col-md-4"></div>
                            </div>
    
                            <div class="row">
                                <div class="col-md-11">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" name="title" id="title" value="{{ post.title }}">
                                        <label for="title">Ej.</label>
                                    </div>
                                </div>
                            </div>                    
    
                            <div class="row">
                                <div class="col-md-6">
                                    <br>
                                    <p class="subtitlestn">Fecha de inicio: </p>
                                    <div class="form-floating">
                                        <input type="number" class="form-control" id="date1" name="date1" value="{{ post.date1 }}" maxlength="4" oninput="this.value = this.value.slice(0, 4)" max="2023" >
                                        <label for="date1">Año</label>
                                    </div>
                                </div>
                
                                <!--Era-->
                                <div class="col-md-4">
                                    <br>
                                    <p class="subtitlestn">a. C. / d. C. </p>
                                    <div class="form-floating">
                                        <select class="form-control" id="edad1" name="edad1" required>
                                            <option value="a. C." {% if post.edad1 == "a. C." %} selected {% endif %}>a. C.</option>
                                            <option value="d. C." {% if post.edad1 == "d. C." %} selected {% endif %}>d. C.</option>
                                        </select>
                                        <label for="edad1">Era</label>
                                    </div>
                                </div>
                            </div>
    
                            <div>
                                <br>
                            </div>
    
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="subtitlestn">Fecha de finalización: </p>
                                    <div class="form-floating">
                                        <input type="number" class="form-control" id="date2" name="date2" value="{{ post.date2 }}" maxlength="4" oninput="this.value = this.value.slice(0, 4)" max="2023" >
                                        <label for="date2">Año</label>
                                    </div>
                                </div>
                
                                <!--Era-->
                                <div class="col-md-4">
                                    <p class="subtitlestn">a. C. / d. C. </p>
                                    <div class="form-floating">
                                        <select class="form-control" id="edad2" name="edad2" required>
                                            <option value="a. C." {% if post.edad2 == "a. C." %} selected {% endif %}>a. C.</option>
                                            <option value="d. C." {% if post.edad2 == "d. C." %} selected {% endif %}>d. C.</option>
                                        </select>
                                        <label for="edad2">Era</label>
                                    </div>
                                </div>
                            </div>
    
                            <div>
                                <br>
                            </div>
    
                            <div class="row">
                                <div class="col-md-6">
                                    <br>
                                    <p class="subtitlestn">Descripción:</p>
                                </div>
                
                                <!--Era-->
                                <div class="col-md-4"></div>
                            </div>
    
                            <div class="row">
                                <div class="col-md-11">
                                    <div class="form-floating">
                                        <textarea class="form-control" name="descripcion" id="descripcion" required>{{ post.descripcion }}</textarea>
                                        <label for="descripcion">Año</label>
                                    </div><br>
                                </div>
                            </div>
    
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="subtitlestn">URL:</p>
                                </div>
                
                                <!--Era-->
                                <div class="col-md-4"></div>
                            </div>
                            
                            <div class="row">
                                <div class = "col-md-11">
                                    <div class = "form-floating">
                                        <input type="text" class="form-control" name="image" id="image" value="{{ post.image }}">
                                        <label for="imagen">URL</label>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <br>
                            </div>
    
                            <div class="modal-footer">
                                <button type="button" class="btn botona" data-bs-dismiss="modal">Cancelar</button>
                                <button class="input-group-text botona rounded" type="submit" value="Save">Guardar</button>
    
                            </div>
                            
                        </div>
    
                    </div>
                </div>
            </form>

            <script>
                // Función para mostrar mensajes de validación
                function mostrarMensaje(mensaje) {
                    var mensajeDiv = document.getElementById('mensajeValidacion');
                    mensajeDiv.innerHTML = mensaje;
                    mensajeDiv.style.visibility = 'visible';
                }
            
                // Función para ocultar el mensaje
                function ocultarMensaje() {
                    document.getElementById('mensajeValidacion').style.visibility = 'hidden';
                }
            
                // Función para validar si una URL es válida
                function esURLValida(url) {
                    var regex = /^(ftp|http|https):\/\/[^ "]+$/;
                    return regex.test(url);
                }
            
                // Función de validación para el campo de título
                function validarTitulo() {
                    var title = document.getElementById('title').value;
            
                    if (!/^[A-Z][a-z]*$/.test(title)) {
                        mostrarMensaje('El campo título debe comenzar con una letra mayúscula.');
                        return false;
                    }
                    ocultarMensaje();
                    return true;
                }
            
                // Función de validación para el campo de fecha
                function validarFecha(idFecha) {
                    var fecha = parseInt(document.getElementById(idFecha).value);
            
                    if (fecha > 2023 || fecha < 0) {
                        mostrarMensaje('Los años deben estar entre 0 y 2023.');
                        return false;
                    }
                    ocultarMensaje();
                    return true;
                }
            
                // Función de validación para el campo de descripción
                function validarDescripcion() {
                    var descripcion = document.getElementById('descripcion').value;
            
                    if (descripcion === '' || descripcion.length < 50 || descripcion.length > 500) {
                        mostrarMensaje('La descripción debe contener entre 50 y 500 caracteres.');
                        return false;
                    }
                    ocultarMensaje();
                    return true;
                }
            
                // Función de validación para el campo de imagen
                function validarImagen() {
                    var image = document.getElementById('image').value;
            
                    if (!esURLValida(image)) {
                        mostrarMensaje('El campo URL de imagen no es una URL válida.');
                        return false;
                    }
                    ocultarMensaje();
                    return true;
                }
            
                // Nueva función para verificar si todos los campos están llenos
                function validarCamposLlenos() {
                    var campos = [
                        document.getElementById('title').value,
                        document.getElementById('date1').value,
                        document.getElementById('date2').value,
                        document.getElementById('descripcion').value,
                        document.getElementById('image').value,
                        document.getElementById('edad1').value,
                        document.getElementById('edad2').value
                    ];

                    var nombresCampos = ["Título", "Fecha de inicio", "Fecha de finalización", "Descripción", "URL de imagen", "Era de inicio", "Era de finalización"];
                    var camposVacios = [];

                    for (var i = 0; i < campos.length; i++) {
                        if (campos[i] === '') {
                            camposVacios.push(nombresCampos[i]);
                        }
                    }

                    if (camposVacios.length > 0) {
                        mostrarMensaje('Los siguientes campos deben estar llenos: ' + camposVacios.join(', ') + '.');
                        return false;
                    }

                    ocultarMensaje();
                    return true;
                }

            
                function validarFormulario(event) {
                    var esTituloValido = validarTitulo();
                    var esFechaInicioValida = validarFecha('date1');
                    var esFechaFinValida = validarFecha('date2');
                    var esDescripcionValida = validarDescripcion();
                    var esImagenValida = validarImagen();
                    var sonCamposLlenosValidos = validarCamposLlenos();

                    if (!sonCamposLlenosValidos || !esTituloValido || !esFechaInicioValida || !esFechaFinValida || !esDescripcionValida || !esImagenValida) {
                        event.preventDefault(); // Previene el envío del formulario si alguna validación falla
                        // No mostrar un mensaje general aquí ya que cada función de validación tiene su propio mensaje
                        return false;
                    }
                    ocultarMensaje(); // Oculta el mensaje si todas las validaciones son exitosas
                    return true;
                }

            
                // Asignar manejadores de eventos
                document.addEventListener('DOMContentLoaded', function () {
                    document.getElementById('editarModalForm').addEventListener('submit', validarFormulario);
                    document.getElementById('title').addEventListener('input', validarTitulo);
                    document.getElementById('date1').addEventListener('input', validarFecha.bind(null, 'date1'));
                    document.getElementById('date2').addEventListener('input', validarFecha.bind(null, 'date2'));
                    document.getElementById('descripcion').addEventListener('input', validarDescripcion);
                    document.getElementById('image').addEventListener('input', validarImagen);
                });
            </script>
            

            <!-- Primera sección de la página (Título, fechas y descripción de la época) -->
            <div class ="row">
                <div class ="col-md"><br><br>
                    <p class="title">{{post.title}}</p><br>
				    <p class ="subtitle">{{post.date1}} {{post.edad1}} - {{post.date2}} {{post.edad1}}</p><br>
				    <p class ="texto">{{post.descripcion}}</p><br>
                </div>
            </div>
            <!-- Segunda sección de la página presentación de subelementos -->
            <div class="row">
                <!--Bucle sobre el array de subelementos-->
                {{#post.subelemento}}
                    <div class="col-md-4 col-sm-12 post-item">
                        <div class="post-link">
                            <!--Enlace a la imágen de la obra-->
                            {{#obra}}
                                <img src="{{.}}" class="galeria">
                            {{/obra}}
                            <!--Título de la obra-->
                            {{#titulo}}
                                <p class="texto"><br>Título: {{.}}</p>
                            {{/titulo}}
                        </div>
            
                        <div class="post-link">
                            <!--Artista de la obra-->
                            {{#Creador}}
                                <p class="texto">Creador: {{.}}</p>
                            {{/Creador}}
                            
                            <!--Fecha de creación de la obra-->
                            {{#Fecha_Creacion}}
                                <p class="texto">Fecha de creación: {{.}}</p>
                            {{/Fecha_Creacion}}
                        </div>
            
                        <div class="post-link">
                            <!--Técnica de la obra-->
                            {{#tecnica}}
                                <p class="texto">Técnica: {{.}}</p>
                            {{/tecnica}}
                        </div>
                    </div>
                {{/post.subelemento}}
            </div>
            <div class="row">
                <!-- Título del formulario para agregar subelementos -->
                <p class ="title2">¡Se parte de esta corriente artística y sube tu obra!</p>
            </div>
            <div class="container text-center">
                <hr><br>
                <form action = '/post/{{post.id}}/update' method="post">
                    <div class = "row">
                        <!-- Sección del formulario para título de la obra -->
                        <div class="col-md-6">
                            <div class="col-md">
                                <p class="subtitlest">Título de la obra</p>
                            </div>
                            <div class = "form-floating">
                                <input type="text" class="form-control" name="subelemento[titulo]" required>
                                <label for="NombreObra">Ej. The Interrupted Sleep</label><br><br>
                            </div>
                        </div>
                        <!-- Sección del formulario para creador de la obra -->
                        <div class="col-md-6">
                            <div class="col-md">
                                <p class="subtitlest">Creador de la obra</p>
                            </div>
                            <div class="form-floating">
                                <input type="text" class="form-control" name="subelemento[Creador]" required>
                                <label for="Creadorobra">Ej. François Boucher</label> <br><br>
                            </div>
                        </div>
                        </div>
                        <div class="row">
                            <!-- Sección del formulario para fecha de creación -->
                            <div class="col-md-6">
                                <div class="col-md">
                                    <p class="subtitlest">Fecha de creación</p>
                                </div>
                                <div class="form-floating">
                                    <input type="number" class="form-control" name="subelemento[Fecha_Creacion]" maxlength="4" oninput="this.value = this.value.slice(0, 4)" max="2023" required>
                                    <label for="Fecha_Creacion">Ej.2001</label>
                                    <br> <br>
                                </div>
                            </div>
            
                            <!-- Sección del formulario para técnica de la obra -->
                            <div class="col-md-6">
                                <div class="col-md">
                                    <p class="subtitlest">Técnica</p>
                                </div>
                                <div class="form-floating">
                                    <input type="text" class="form-control" name="subelemento[tecnica]" required>
                                    <label for="tecnica">Ej. Óleo sobre lienzo</label> <br><br>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md">
                                <h1 class="subtitlest">¡Sube tu obra!</h1>
                            </div>
                        </div>
                        <div class="row">
                            <!-- Sección del formulario para subir obra -->
                            <div class = "col-md-6">
                                <div class = "flex-row">
                                    <!-- Espacio para subir el url de la obra y botón para subir todo el formulario -->
                                    <div class="input-group md-6">
                                        <input type="text" class="form-control" name="subelemento[obra]" required >
                                        <button class="input-group-text botona rounded" type="submit" value="Guardar">Guardar</button>
                                    </div>
                                </div>
                            </div>
            
                            <!-- Botón para regresar a la página principal -->
                            <div class="col-md-6 d-flex">
                                <a class="input-group-text botona rounded" href="/" >Regresar a inicio</a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>  
        <br>
    </body>
</html>